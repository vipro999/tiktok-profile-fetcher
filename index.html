<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Get Coins">
<link rel="apple-touch-icon" href="icon-192.png">
<link rel="manifest" href="manifest.json">
<title>Collect Rewards</title>
<style>
*{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:0;padding:0}
body{background:#fff;color:#111;display:flex;flex-direction:column;align-items:center;padding:8px;max-width:480px;margin:0 auto;}
header{width:100%;display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;padding-top:env(safe-area-inset-top)}
header img{height:32px}
header h1{font-size:1.3rem;font-weight:700;text-align:center;position:absolute;left:50%;transform:translateX(-50%)}
.stats{width:100%;background:#f9f9f9;padding:12px;border-radius:10px;margin-bottom:14px;box-shadow:0 2px 6px rgba(0,0,0,0.04)}
.stats div{font-weight:700}
.input-section{width:100%;margin-bottom:12px}
.input-section input{width:100%;padding:10px;border-radius:8px;border:1px solid #ddd;font-size:1rem}
.coins-grid{width:100%;display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:2px 0}
.coin-card{border:1px solid #e6e6e9;border-radius:10px;padding:12px;text-align:center;cursor:pointer;background:#fff;transition:all .15s;display:flex;flex-direction:column;align-items:center;gap:8px}
.coin-card:active{transform:scale(.98)}
.coin-card.active{border:2px solid #ff0050;background:linear-gradient(180deg,#fff7fb,#fff)}
.coin-top{display:flex;align-items:center;gap:8px;font-weight:600}
.coin-top img{width:20px;height:20px}
.price{color:#666;font-size:0.92rem}
.total{font-weight:700;margin:12px 0;font-size:1.05rem}
.btn{width:100%;background:#ff0050;color:#fff;border:none;padding:12px;border-radius:10px;font-weight:700;cursor:pointer;font-size:1rem}
.overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.32);z-index:50;-webkit-backdrop-filter:blur(6px);backdrop-filter:blur(6px)}
.overlay.show{display:flex;animation:fadeIn .2s ease-in-out}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.panel{background:#fff;border-radius:14px;padding:18px;width:calc(100% - 40px);max-width:420px;text-align:center;box-shadow:0 18px 60px rgba(0,0,0,.25)}
.success-icon{width:86px;height:86px;border-radius:50%;background:linear-gradient(135deg,#07b36e,#05a66a);display:flex;align-items:center;justify-content:center;color:#fff;font-size:40px;margin:0 auto 12px;box-shadow:0 12px 40px rgba(6,166,107,.18)}
.header-left{display:flex;align-items:center;width:100%;padding:10px 16px;box-sizing:border-box;gap:8px}
.logo{height:32px}
.tiktok-username{font-weight:600;font-size:1rem}
.history-link{margin-left:auto;text-decoration:none;color:#007bff;font-size:0.9rem}

/* üîπ Payment Section */
.payment-section{width:100%;margin-top:14px;text-align:center}
.pay-btn{background:#007bff;color:#fff;border:none;padding:12px 16px;border-radius:10px;font-weight:700;cursor:pointer;font-size:1rem;transition:.2s}
.pay-btn:hover{background:#005fcc}

/* üîπ Order Summary Popup */
#orderSummaryOverlay .panel h3{margin-bottom:10px;text-align:center;}
.payment-option{border:1px solid #ddd;border-radius:8px;padding:8px;margin-top:8px;cursor:pointer;display:flex;align-items:center;gap:10px;transition:.2s;text-align:center;justify-content:center;}
.payment-option:hover{border-color:#007bff;background:#f2f8ff}
.payment-option span{font-weight:600}
.cancel-btn{margin-top:12px;padding:10px 16px;border:none;background:#ccc;color:#111;border-radius:10px;cursor:pointer;font-weight:600}
.cancel-btn:hover{background:#bbb}

/* üîπ Hi·ªáu ·ª©ng 2 ch·∫•m xanh ƒë·ªè di chuy·ªÉn v√† nh·∫•p nh√°y nh∆∞ iPhone */
#loadingOverlay {
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(255,255,255,0.85);
  backdrop-filter: blur(6px);
  z-index: 1000;
}
#loadingOverlay.show {
  display: flex;
}

.dots-wrapper {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 18px;
  animation: moveDots 1.2s infinite ease-in-out;
}

.dot {
  width: 16px;
  height: 16px;
  border-radius: 50%;
  animation: blink 0.8s infinite alternate;
}

.dot.blue {
  background-color: #007aff; /* xanh iPhone */
  animation-delay: 0s;
}
.dot.red {
  background-color: #ff3b30; /* ƒë·ªè iPhone */
  animation-delay: 0.4s;
}

@keyframes blink {
  from { opacity: 0.4; transform: scale(0.9); }
  to { opacity: 1; transform: scale(1.2); }
}

@keyframes moveDots {
  0%, 100% { transform: translateX(0); }
  50% { transform: translateX(10px); }
}

/* üîÑ Loading Spinner */
.loading-spinner {
  border: 4px solid #eee;
  border-top: 4px solid #007bff;
  border-radius: 50%;
  width: 50px;
  height: 50px;
  animation: spin 1s linear infinite;
  margin: 20px auto;
}
.pay-method {
  font-family: system-ui, sans-serif;
  color: #333;
}

.label {
  display: block;
  font-weight: 600;
  margin-bottom: 4px;
}

.card-line {
  display: flex;
  align-items: center;
  gap: 8px;
  background: #fff;
  padding: 8px 12px;
  border-radius: 8px;
}
/* üîò Ch·∫•m tr√≤n ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n */
.card-line {
  display: flex;
  align-items: center;
  gap: 8px;
  background: #fff;
  padding: 8px 12px;
  border-radius: 8px;
  border: 1px solid #ddd;
  cursor: pointer;
  transition: 0.2s;
}

.card-line:hover {
  background: #f8faff;
  border-color: #007aff;
}

.radio-dot {
  width: 16px;
  height: 16px;
  border-radius: 50%;
  border: 2px solid #bbb;
  margin-right: 4px;
  position: relative;
}

.card-line.active .radio-dot {
  border-color: #ff3b30; /* ƒë·ªè khi ch·ªçn */
}

.card-line.active .radio-dot::after {
  content: "";
  position: absolute;
  top: 3px;
  left: 3px;
  width: 8px;
  height: 8px;
  background: #ff3b30;
  border-radius: 50%;
}

.card-icon {
  width: 32px;
  height: auto;
}

.card-number {
  font-size: 15px;
  letter-spacing: 1px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

@media(max-width:420px){.coins-grid{grid-template-columns:1fr 1fr}}
</style>
</head>
<body>
<header><h1 class="title">Get Coins</h1></header>

<div class="header-left">
<img src="daidien2.png" alt="avatar" class="logo" style="width:20px;height:20px;border-radius:50%;" />
<span class="tiktok-username">Jackw******</span>
<a href="#" class="history-link">View history</a>
</div>

<div class="stats" aria-live="polite"
     style="display:flex; flex-direction:column; align-items:flex-start; gap:1px; width:100%; height: 1.5cm; margin-top:2px;">
  <div style="display:flex; align-items:center; gap:6px;">
    <div style="margin-left:26px;">
      <div style="font-weight:700; font-size:1.1rem;">
        <span id="hh">Recharge</span>
      </div>
      <div style="font-weight:400; font-size:0.9rem; display:flex; align-items:center; gap:4px;">
        <img src="wallet.png" alt="coin icon" width="18" height="18"/>
        <span id="totalCoins">$3,000,000.00</span>
      </div>
    </div>
  </div>
</div>

</div>
  </div>
 <div id="totalUsd" style="visibility:hidden; height:2px;"> </div>
</div>

<div class="input-section" style="height:0.55cm;"">
  <input id="tiktokId" type="text" placeholder=""/>
</div>
<!-- ‚úÖ Khu hi·ªÉn th·ªã th√¥ng tin TikTok th·∫≠t -->
<div id="tiktokProfile" style="display:none; margin:10px 0; width:100%; background:#fafafa; border-radius:10px; padding:10px;">
  <div style="display:flex; align-items:center; gap:10px;">
    <img id="profileAvatar" src="" alt="avatar" style="width:50px; height:50px; border-radius:50%; object-fit:cover; border:1px solid #ddd;">
    <div style="display:flex; flex-direction:column;">
      <span id="profileDisplayName" style="font-weight:700;"></span>
      <span id="profileUsername" style="color:#555;"></span>
      <span id="profileFollowers" style="font-weight:600; color:#111; margin-top:4px;"></span>
    </div>
  </div>
  <div id="profileError" style="display:none; color:#c00; margin-top:8px; font-size:0.9rem;"></div>
</div>


<p style="text-align:left; margin-top:10px; margin-left:4px; font-size:0.95rem;">
  <span style="color:#000; font-weight:600;">Top up :</span>
  <span style="color:#ff0050; font-weight:600;">Save around 25% with lower third-party service fees.</span>
</p>

<div class="coins-grid" id="coinGrid"></div>

<div class="coins-grid" id="coinGrid"></div>

<div class="coins-grid" id="coinGrid" style="margin-bottom:0;"></div>

<div style="text-align:left; margin:6px 0 2px 4px; line-height:1.3; padding-left:0.5cm;">
  <span style="color:#ff0050; font-weight:700;">5%</span>
  <span style="color:#000; font-weight:500;">Recharge to unlock 5% cashback up to $250 on your next Coin purchase</span><br>
  <span style="color:#666; font-size:0.9rem;">Default invite code applied. Change code</span>
</div>

<div style="display:flex; align-items:center; flex-wrap:wrap; gap:6px; text-align:left; margin-top:2px; padding-left:0.5cm; width:100%;">
  <span style="font-weight:500; color:#000; font-size:0.9rem;">Payment Method:</span>
  <img src="visa.png" alt="Visa" style="width:22px; height:auto;">
  <img src="mastercard.png" alt="MasterCard" style="width:22px; height:auto;">
  <img src="discover.png" alt="Discover" style="width:22px; height:auto;">
  <img src="diners.png" alt="Diners" style="width:22px; height:auto;">
  <img src="card_american_express.png" alt="American Express" style="width:22px; height:auto;">
  <img src="BankTransfer_facae.png" alt="Bank Transfer" style="width:22px; height:auto;">
</div>

<div class="total">Total: $<span id="total">0.00</span></div>

<div class="payment-section">
  <button id="proceedBtn" class="pay-btn" 
    style="background-color:#e60000; color:#fff; border:none; padding:10px 20px; border-radius:8px; font-weight:600; cursor:pointer;">
    Recharge
  </button>
</div>

<div id="orderSummaryOverlay" class="overlay" aria-hidden="true">
  <div class="panel" style="text-align:left;">
    <h3>Order Summary</h3>

    <div style="border:1px solid #ddd;border-radius:12px;padding:14px;margin-top:10px;background:#fafafa;">
      <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
        <span>Selected Package:</span>
        <strong id="summaryPackage">-</strong>
      </div>
      <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
        <span>Service Fee:</span>
        <strong>$0.00</strong>
      </div>

      <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
        <span>Sent to user:</span>
        <strong id="summaryUser">-</strong>
      </div>

      <hr style="margin:10px 0;">
      <div style="display:flex;justify-content:space-between;font-weight:700;">
        <span>Total:</span>
        <span id="summaryTotal">$0.00</span>
      </div>
    </div>

    <div style="margin-top:20px;text-align:center;">
  <div class="pay-method">
  <span class="label">Pay method</span>
  <div class="card-line selectable" data-method="visa">
  <div class="radio-dot"></div>
  <img src="https://cdn-icons-png.flaticon.com/512/349/349230.png" alt="Visa" class="card-icon">
  <span class="card-number">Visa ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 5674</span>
</div>

<div class="card-line selectable" data-method="mastercard">
  <div class="radio-dot"></div>
  <img src="mastercard.png" alt="Mastercard" class="card-icon">
  <span class="card-number">Mastercard ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 3451</span>
</div>

<div class="card-line selectable" data-method="paypal">
  <div class="radio-dot"></div>
  <img src="paypal.png" alt="PayPal" class="card-icon">
  <span class="card-number">PayPal ‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢@gmail.com</span>
</div>

</div>

     <div class="payment-option" data-method="Apple" style="background-color:#fe2c55;color:#fff;padding:10px 14px;border-radius:8px;text-align:center;font-weight:600;cursor:pointer;">
  <span>Recharge</span>
</div>
    </div>

    <button id="cancelSummary" class="cancel-btn" style="margin-top:14px;width:100%;">Back</button>
  </div>
</div>

<div id="loadingOverlay" class="overlay" aria-hidden="true">
  <div class="dots-wrapper">
    <div class="dot blue"></div>
    <div class="dot red"></div>
  </div>
</div>


<div id="successOverlay" class="overlay" aria-hidden="true">
  <div class="panel">
    <div class="success-icon">‚úì</div>
    <div style="font-weight:800;font-size:18px;margin-bottom:8px">Payment Success</div>
    <div id="successText" style="color:#444;margin-bottom:12px"></div>
    <button id="backBtn" class="btn" style="background:#007bff;">Back to Home</button>
  </div>
</div>

<script>
const packages=[{amount:70},{amount:350},{amount:1000},{amount:10000},{amount:100000}, {amount:500000}, {amount:1000000}];
const baseCoins=30, baseUSD=0.31;
const unitPrice=baseUSD/baseCoins;
const coinGrid=document.getElementById('coinGrid');
const totalEl=document.getElementById('total');
const totalCoinsEl=document.getElementById('totalCoins');
let totalBalance = 3000000; // 3 tri·ªáu ƒë√¥
let selectedPackage=null;

function usdFormat(n){return n.toFixed(2);}
function updateTotalsUI(){
  totalCoinsEl.textContent = `$${totalBalance.toLocaleString(undefined, {minimumFractionDigits:2})}`;
}
updateTotalsUI();

/* Render g√≥i coin */
function renderPackages() {
  packages.forEach(p => {
    const price = +(unitPrice * p.amount).toFixed(2);
    const card = document.createElement('div');
    card.className = 'coin-card';
    card.innerHTML = `
      <div class="coin-top"><img src="coin.png" alt=""> ${p.amount}</div>
      <div class="price">$${usdFormat(price)}</div>
    `;
    card.onclick = () => {
      document.querySelectorAll('.coin-card').forEach(c => c.classList.remove('active'));
      card.classList.add('active');
      selectedPackage = { amount: p.amount, price };
      totalEl.textContent = usdFormat(price);
    };
    coinGrid.appendChild(card);
  });
/* =============================
   üîπ L·∫§Y TH√îNG TIN TIKTOK TH·∫¨T
============================= */

// URL API Vercel (thay domain b·∫±ng c·ªßa b·∫°n sau khi deploy)
const API_BASE = "https://tiktok-profile-fetcher.vercel.app/api/tiktok";

const inputTikTok = document.getElementById("tiktokId");
const profileWrap = document.getElementById("tiktokProfile");
const profileAvatar = document.getElementById("profileAvatar");
const profileDisplayName = document.getElementById("profileDisplayName");
const profileUsername = document.getElementById("profileUsername");
const profileFollowers = document.getElementById("profileFollowers");
const profileError = document.getElementById("profileError");

// debounce ƒë·ªÉ tr√°nh g·ªçi API li√™n t·ª•c khi g√µ
function debounce(fn, delay = 700) {
  let t;
  return (...args) => {
    clearTimeout(t);
    t = setTimeout(() => fn.apply(this, args), delay);
  };
}

async function fetchTikTokInfo(username) {
  profileError.style.display = "none";
  if (!username) {
    profileWrap.style.display = "none";
    return;
  }

  try {
    const res = await fetch(`${API_BASE}/${encodeURIComponent(username)}`);
    const data = await res.json();
    if (data.error) throw new Error(data.error);

    profileAvatar.src = data.avatar || "daidien2.png";
    profileDisplayName.textContent = data.displayName || username;
    profileUsername.textContent = `@${data.username || username}`;
    profileFollowers.textContent = data.followers
      ? `Followers: ${data.followers.toLocaleString()}`
      : "Followers: N/A";

    profileWrap.style.display = "block";
  } catch (err) {
    profileWrap.style.display = "block";
    profileError.textContent = "‚ö†Ô∏è Kh√¥ng th·ªÉ t·∫£i th√¥ng tin TikTok.";
    profileError.style.display = "block";
    profileAvatar.src = "daidien2.png";
    profileDisplayName.textContent = username;
    profileUsername.textContent = "";
    profileFollowers.textContent = "";
  }
}

const handleTikTokInput = debounce((e) => {
  const username = e.target.value.trim().replace(/^@/, "");
  if (username.length > 0) fetchTikTokInfo(username);
  else profileWrap.style.display = "none";
});

inputTikTok.addEventListener("input", handleTikTokInput);
inputTikTok.addEventListener("blur", (e) => {
  const username = e.target.value.trim().replace(/^@/, "");
  if (username) fetchTikTokInfo(username);
});

  const customCard = document.createElement('div');
  customCard.className = 'coin-card';
  customCard.innerHTML = `
    <div class="coin-top"><img src="coin.png" alt=""> Custom</div>
    <div class="price">Enter amount</div>
  `;
  customCard.onclick = () => {
    const val = parseInt(prompt("Enter your desired number of coins:"), 10);
    if (!val || val <= 0) return;

    const price = +(val * unitPrice).toFixed(2);
    document.querySelectorAll('.coin-card').forEach(c => c.classList.remove('active'));
    customCard.classList.add('active');
    customCard.innerHTML = `
      <div class="coin-top"><img src="coin.png" alt=""> ${val.toLocaleString()}</div>
      <div class="price">$${usdFormat(price)}</div>
    `;
    selectedPackage = { amount: val, price };
    totalEl.textContent = usdFormat(price);
  };
  coinGrid.appendChild(customCard);
}

renderPackages();

const proceedBtn=document.getElementById('proceedBtn');
const orderSummaryOverlay=document.getElementById('orderSummaryOverlay');
const cancelSummary=document.getElementById('cancelSummary');
const paymentChoices=orderSummaryOverlay.querySelectorAll('.payment-option');
const successOverlay=document.getElementById('successOverlay');
const successText=document.getElementById('successText');
const backBtn=document.getElementById('backBtn');

proceedBtn.onclick=()=>{
  const tiktokId=document.getElementById('tiktokId');
  if(!selectedPackage){alert('Please select a coin package first.');return;}
  if(!tiktokId.value.trim()){alert('Please enter your TikTok username first.');return;}
  document.getElementById('summaryPackage').textContent=`${selectedPackage.amount} Coins`;
  document.getElementById('summaryTotal').textContent=`$${usdFormat(selectedPackage.price)}`;
  document.getElementById('summaryUser').textContent=tiktokId.value.trim();
  orderSummaryOverlay.classList.add('show');
};

cancelSummary.onclick=()=>{orderSummaryOverlay.classList.remove('show');};

paymentChoices.forEach(opt=>{
  opt.onclick=()=>{
    const method=opt.getAttribute('data-method');
    orderSummaryOverlay.classList.remove('show');

    const loadingOverlay=document.getElementById('loadingOverlay');
    loadingOverlay.classList.add('show');

    setTimeout(()=>{
      loadingOverlay.classList.remove('show');
      totalBalance -= selectedPackage.price;
      if (totalBalance < 0) totalBalance = 0;
      updateTotalsUI();
      successText.innerHTML = `
        You recharge Coins successfully.<br>
        This operation has been completed and will be processed within 24 hours!
      `;
      successOverlay.classList.add('show');
    },2000);
  };
});
const cardLines = document.querySelectorAll('.card-line.selectable');
let selectedMethod = null;

cardLines.forEach(card => {
  card.onclick = () => {
    cardLines.forEach(c => c.classList.remove('active'));
    card.classList.add('active');
    selectedMethod = card.getAttribute('data-method');
  };
});


backBtn.onclick=()=>{
  successOverlay.classList.remove('show');
  document.getElementById('tiktokId').value='';
  totalEl.textContent='0.00';
  document.querySelectorAll('.coin-card').forEach(x=>x.classList.remove('active'));
  selectedPackage=null;
};
</script>
</body>
</html>
